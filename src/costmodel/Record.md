CostModel



RLModel
需要构建一个强化学习模型，该模型负责根据 CostModel 提供的成本，动态选择每一个计算算子使用 HE 或 SS 技术，同时考虑以下因素：

HE 和 SS 的转换成本：

当连续选择的技术发生变化时（例如从 HE 切换到 SS），需要考虑切换成本。
同样，SS 切换到 HE 也需计算转换成本。
HE 的 Bootstrapping 成本：

当连续选择 HE 技术超过一定次数时，需要考虑 Bootstrapping 成本。
序列级决策：

强化学习不仅要为单个算子选择技术，还要结合整个算子序列的执行路径，综合考虑总成本，选择最优执行方案。



# 模块总结：`abstractop`、`costmodel` 和 `rlmodel`

总结了三个关键模块的角色和职责：`abstractop`、`costmodel` 和 `rlmodel`。

---

## 1. `abstractop` 模块

### 目的：
`abstractop` 模块负责定义 MLIR 操作的执行流程。它提供了解析、选择执行技术（HE 或 SS）以及协调与成本模型和强化学习系统交互的结构。（抽象集成）

### 主要职责：
1. **执行 MLIR 操作**：
   - 提供方法执行单个 MLIR 操作（如 `tosa_add`、`tosa_matmul`），并选择使用 HE（同态加密）或 SS（秘密共享）技术。
   - 通过 `party` 参数支持 ALICE 和 BOB 的双方执行。

2. **算子序列执行**：
   - 支持执行一组 MLIR 操作序列，并通过强化学习和成本模型优化具体协议执行顺序。

3. **与成本模型和强化学习模型的集成**：
   - 调用 `RLModel` 来决定每个操作的最佳技术（HE 或 SS）。
   - 在执行过程中考虑 HE-SS 转换成本和 HE 的 Bootstrapping 成本。

4. **动态技术选择**：
   - 根据 `costmodel` 提供的成本数据动态选择每个操作的执行技术。

---
## 2. `costmodel` 模块

### 目的：
`costmodel` 模块用于估算使用不同技术（HE 或 SS）执行 MLIR 操作的成本。它为强化学习模型提供关键输入，以便做出技术选择。

### 主要职责：
1. **tosa级别算子成本估算**：
   - 估算使用 HE 或 SS 执行给定操作的成本。
   - 为每种技术提供操作特定的成本指标。

2. **密码原语转换成本**：
   - 定义在 HE 和 SS 之间切换的成本（如 HE 转换到 SS 或 SS 转换到 HE 的成本）。

3. **HE-Bootstrapping 成本**：
   - 包括当 HE 连续使用超过一定次数时所需的额外 Bootstrapping 成本。


---


## 3. `rlmodel` 模块

### 目的：
`rlmodel` 模块是选择最佳执行技术（HE 或 SS）的决策引擎。它通过强化学习模型动态优化操作的执行技术，并综合考虑整个算子序列的执行路径。

### 主要职责：
1. **单操作技术选择**：
   - 根据从 `costmodel` 获得的成本数据，为每个操作选择最佳执行技术（HE 或 SS）。

2. **序列优化**：
   - 分析整个操作序列，决定最优的执行策略以最小化总成本。
   - 优化过程中考虑 HE-SS 转换成本和 HE 的 Bootstrapping 成本。

3. **抽象接口以支持扩展**：
   - 提供一个基类（`RLModel`），定义统一接口以进行技术选择和序列优化。
   - 允许通过继承 `RLModel` 轻松扩展更复杂的强化学习模型（如基于神经网络的 RL）。

4. **`SimpleRLModel` 实现**：
   - 实现基础强化学习逻辑，用于优化技术选择和序列执行。
   - 提供如何使用 RL 做出决策的工作示例。

---

## 模块交互总结

- **`abstractop` ↔ `costmodel`**：
  - `abstractop` 模块向 `costmodel` 查询成本估算、转换成本和 Bootstrapping 成本，以便在执行时选择技术。

- **`abstractop` ↔ `rlmodel`**：
  - `abstractop` 模块使用 `rlmodel` 为每个操作选择最佳技术，并优化整个操作序列。

- **`costmodel` ↔ `rlmodel`**：
  - `rlmodel` 依赖 `costmodel` 提供的准确成本数据，以便进行技术选择和序列优化。

---

## 未来扩展建议

1. **高级强化学习**：
   - 扩展 `RLModel`，引入更复杂的模型，例如基于神经网络或深度强化学习的模型，以提高决策的智能性。

2. **动态成本调整**：
   - 增强 `costmodel`，根据运行时的网络环境和计算负载动态调整成本。

3. **并行执行**：
   - 扩展 `abstractop`，支持在分布式环境中并行执行操作。